package com.fuse.dao;

import java.util.ArrayList;
import java.util.List;

import javax.persistence.CascadeType;
import javax.persistence.Entity;
import javax.persistence.EntityManager;
import javax.persistence.FetchType;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.ManyToOne;
import javax.persistence.OneToMany;
import javax.persistence.TableGenerator;
import javax.persistence.Transient;

@Entity
public class DefaultVulnerability {
	
	@Id
	@GeneratedValue(strategy = GenerationType.TABLE, generator = "dvulnGen")
    @TableGenerator(
        name = "dvulnGen",
        table = "dvulnGenseq",
        pkColumnValue = "dvuln",
        valueColumnName = "nextdVuln",
        initialValue = 1,
        allocationSize = 1
    )
	private long id;
	private String name;
	private String description;
	private String recommendation;
	@ManyToOne
	private Category category;
	private int likelyhood;
	private int impact;
	private int overall;
	private String cvss31Score;
	private String cvss40Score;
	private String cvss31String;
	private String cvss40String;
	@OneToMany(fetch = FetchType.EAGER, cascade = CascadeType.ALL, orphanRemoval=true)
	private List<CustomField> CustomFields;
	private Boolean active;
	
	@Transient
	private List<RiskLevel>levels = new ArrayList();
	
	public long getId() {
		return id;
	}
	public void setId(long id) {
		this.id = id;
	}
	public String getName() {
		return name;
	}
	public void setName(String name) {
		this.name = name;
	}
	public String getDescription() {
		return description;
	}
	public void setDescription(String description) {
		this.description = description;
	}
	public String getRecommendation() {
		return recommendation;
	}
	public void setRecommendation(String recommendation) {
		this.recommendation = recommendation;
	}
	public Category getCategory() {
		return category;
	}
	public void setCategory(Category category) {
		this.category = category;
	}
	public int getLikelyhood() {
		return likelyhood;
	}
	public void setLikelyhood(int likelyhood) {
		this.likelyhood = likelyhood;
	}
	public int getImpact() {
		return impact;
	}
	public void setImpact(int impact) {
		this.impact = impact;
	}
	public int getOverall() {
		return overall;
	}
	public void setOverall(int overall) {
		this.overall = overall;
	}
	@Transient
	public void updateRiskLevels(EntityManager em){
		levels = em.createQuery("from RiskLevel").getResultList();
	}
	@Transient
	public void updateRiskLevels(){
		EntityManager em = HibHelper.getInstance().getEM();
		levels = em.createQuery("from RiskLevel").getResultList();
		em.close();
	}
	@Transient
	public String vulnStr(int id){
		for(RiskLevel level : levels){
			if(id == level.getRiskId())
				return level.getRisk();
		}
		return "Unassigned";
		/*switch(id.intValue()){
			case 0 : return "Informational";
			case 1 : return "Recommended";
			case 2 : return "Low";
			case 3 : return "Medium";
			case 4 : return "High";
			case 5 : return "Critical";
			default : return "junk";
		}*/
	}
	
	public String getImpactStr(){
		return this.vulnStr(this.impact);
	}
	public String getOverallStr(){
		return this.vulnStr(this.overall);
	}
	public String getLikelyhoodStr(){
		return this.vulnStr(this.likelyhood);
	}
	public String getCvss31Score() {
		return cvss31Score;
	}
	public void setCvss31Score(String cvssScore) {
		this.setSeverityScore(cvssScore);
		this.cvss31Score = cvssScore;
	}
	public String getCvss40Score() {
		return cvss40Score;
	}
	public void setCvss40Score(String cvssScore) {
		this.setSeverityScore(cvssScore);
		this.cvss40Score = cvssScore;
	}
	
	@Transient
	public void setSeverityScore(String cvssScore) {
		try {
			Float score = Float.parseFloat(cvssScore);
			if(score >= 9.0f) this.overall = 5;
			else if (score >= 7.0f) this.overall = 4;
			else if (score >= 4.0f) this.overall = 3;
			else if (score > 0.0f) this.overall = 2;
			else this.overall = 1;
		}catch(Exception ex) {
			this.overall = 1;
		}
	}
	
	public List<CustomField> getCustomFields() {
		return CustomFields;
	}
	public void setCustomFields(List<CustomField> customFields) {
		CustomFields = (List<CustomField>) customFields;
	}
	public Boolean getActive() {
		return active;
	}
	public void setActive(Boolean active) {
		this.active = active;
	}
	public String getCvss31String() {
		return cvss31String;
	}
	public void setCvss31String(String cvss31String) {
		this.cvss31String = cvss31String;
	}
	public String getCvss40String() {
		return cvss40String;
	}
	public void setCvss40String(String cvss40String) {
		this.cvss40String = cvss40String;
	}
	
	
	
	
	
	
	
	
	
	
}
